---

machine:
  environment:
    PYTHON_BUILD_PATH: $HOME
    PYTHON_BUILD_VERSION: 2.7.10
    PYTHON_EXEC_PATH: $PYTHON_BUILD_PATH/Python-$PYTHON_BUILD_VERSION/bin
    PYTHON_TARBALL: Python-$PYTHON_BUILD_VERSION.tar.xz
    VTK_BUILD_PATH: $HOME
    VTK_BUILD_VERSION: 5.10.1
    VTK_UNTAR_PATH: $VTK_BUILD_PATH/VTK$VTK_BUILD_VERSION

dependencies:
  pre:
    - bash -x ./install/vtk.sh
    - bash -x ./install/python.sh

  post:
    - $PYTHON_EXEC_PATH/pip install -r ./install/requirements.txt

  cache_directories:
    - ~/Python-2.7.10/
    - ~/VTK5.10.1/

test:
  override:
    - $PYTHON_EXEC_PATH/python -m pytest ~/chagu/test/ --cov=chagu --cov-report term-missing:
        environment:
          LD_LIBRARY_PATH: "$LD_LIBRARY_PATH:$VTK_UNTAR_PATH/bin"
          PYTHONPATH: "$PYTHONPATH:$HOME/chagu:$VTK_UNTAR_PATH/Wrapping/Python:$VTK_UNTAR_PATH/bin"