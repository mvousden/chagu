---

machine:
  environment:
    CONDA_PATH: $HOME/miniconda2
    CONDA_ENV: circleci-test
    CONDA_BIN: $CONDA_PATH/bin
    CHAGU_CI: $HOME/chagu/ci

dependencies:

  # Setup conda idempotently.
  pre:
    - $CHAGU_CI/install_conda.sh

  cache_directories:
    - $CONDA_PATH

test:
  override:
    # Activate conda environment and run tests.
    - source $CONDA_BIN/activate $CONDA_ENV && python -m pytest $HOME/chagu/test/ --cov=chagu --cov-report term-missing --verbose --junitxml=$CIRCLE_TEST_REPORTS/test-report.xml

  # Codecov business (we install codecov using pip in the dependency step).
  post:
    - source $CONDA_BIN/activate $CONDA_ENV && bash <(curl -s https://codecov.io/bash)